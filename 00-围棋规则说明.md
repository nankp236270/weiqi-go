# 围棋游戏规则规范 (Go Game Rules Specification)

## 0. 引言
本文件定义了 `weiqi-go` 项目中围棋游戏的官方规则。所有语言的实现（包括 Go 语言的游戏逻辑后端和 Python 语言的 AI 训练环境）都**必须**严格遵守此规范，以确保规则的绝对一致性。

本项目采用**中国围棋规则**。

## 1. 游戏元素
### 1.1. 棋盘 (Board)
*   棋盘是一个由 19x19 条线交叉构成的网格，共形成 361 个交叉点，称为“点”。
*   棋盘坐标系：我们定义左上角为 (0, 0)，右下角为 (18, 18)。

### 1.2. 棋子 (Stones)
*   棋子分黑、白两种颜色。
*   对局双方各执一色。

## 2. 游戏流程
### 2.1. 开局 (Opening)
*   黑棋先行，双方轮流在棋盘的空点上落子。

### 2.2. 行棋 (Placing a Stone)
*   每次只能在棋盘上没有棋子的空点落下一子。
*   棋子落下后，不可再移动位置。

### 2.3. 虚手 (Passing)
*   轮到一方行棋时，该方可以选择“虚手”，即放弃该回合的落子权利。

### 2.4. 游戏结束 (End of Game)
*   当双方连续“虚手”时，对局结束。

## 3. 核心规则
### 3.1. 气 (Liberty)
*   一个棋子在棋盘上，与其上下左右直接相邻的空点，是这个棋子的“气”。
*   多个同色棋子连接在一起形成一个“棋块”，这个棋块的“气”是所有组成棋子的气的总和（不重复计算）。

### 3.2. 提子 (Capture)
*   当一个棋子或棋块的最后一“气”被对方棋子占据后，这个棋子或棋块就被“提掉”。
*   被提掉的棋子必须立即从棋盘上拿走。
*   一次落子可能同时提掉对方一个或多个棋块。

### 3.3. 禁入点 (Illegal Moves)
#### 3.3.1. 自杀禁令 (No Suicide)
*   一个落子点是“禁入点”，如果落子后，该子本身或其所属的棋块会立即变为无“气”状态。
*   **例外**：如果该落子能同时提掉对方的一个或多个棋块，从而使己方棋块重获“气”，则该落子是**允许**的。

#### 3.3.2. 全局同形再现禁令 (Positional Superko)
*   禁止通过落子导致棋盘局面恢复到本局中之前任何一个回合出现过的状态。
*   此规则用于防止无限循环，例如在“打劫”场景中。实现时，需要记录每一手之后的全盘状态。

## 4. 胜负计算
### 4.1. 计分规则
*   采用**中国规则**（子空皆地）进行计分。
*   对局结束后，双方需要就棋盘上棋子的死活达成共识。在程序中，我们将通过算法自动判断。

### 4.2. 活棋与死棋 (Live and Dead Stones)
*   **活棋**：无法被对方提掉的棋块。通常指拥有两个或更多“真眼”的棋块。
*   **死棋**：在对局结束后，即使对方不停落子，也无法做出活棋的棋块。
*   在终局计分前，所有“死棋”都将作为“提子”从棋盘上移除。

#### 4.2.1. 重要补充：提子不计分
*   在计分过程中，被提掉的棋子（包括终局时作为死子移除的棋子）不作为额外得分。
*   计分时，只计算盘面上**活棋的子数**和**活棋所围的实空点数**。

### 4.3. 贴子 (Komi)
*   由于黑棋有先行优势，为了公平，在终局计分时，黑棋需向白棋贴还一部分子数，称为“贴子”。
*   本项目设定**黑方贴给白方 3¾ 子**。

### 4.4. 最终得分与胜负判断 (Final Score & Winning Condition)
*   **计分公式**: 一方的最终得分 = **该方活棋子数** + **该方活棋所围的空点数（实空）**。
*   **公气处理**: 双方之间的公共气点（公气）不计入任何一方的实空。在“子空皆地”的规则下，黑方得分 + 白方得分 的总和恒为 361，公气被天然地平分了。
*   **胜负标准**:
    *   棋盘总点数为 361。胜负线为 361 / 2 = 180.5 子。
    *   考虑到贴子，黑方需要达到的胜线为 180.5 + 3¾ = 184.25 子。
    *   若 **黑方得分 > 184.25**，则**黑方胜**。
    *   否则，**白方胜**。

## 5. 数据表示建议
为了方便 Go 和 Python 的实现，建议采用以下数据结构：
*   **棋盘状态 (Board State)**: 使用一个 19x19 的二维数组表示。
    *   `0`: 空点 (Empty)
    *   `1`: 黑子 (Black)
    *   `2`: 白子 (White)
*   **对局历史 (Game History)**: 使用一个列表或哈希集合来存储出现过的所有棋盘状态（二维数组的哈希值或快照），用于实现“全局同形再现禁令”。
