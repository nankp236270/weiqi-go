# 🧪 测试指南 - 预览颜色和实时刷新

**测试时间**: 2025年12月4日  
**测试内容**: 白棋预览颜色 + 2秒实时刷新

---

## 🎯 测试目标

1. ✅ **预览颜色** - 黑棋显示黑色，白棋显示白色
2. ✅ **实时刷新** - 对方落子后 2 秒内看到更新

---

## 🔧 测试环境

### 服务状态
```bash
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
```

**预期输出**:
```
NAMES            STATUS                    PORTS
weiqi-ai         Up (healthy)             0.0.0.0:8000->8000/tcp
weiqi-backend    Up                       0.0.0.0:8080->8080/tcp
weiqi-mongo      Up (healthy)             0.0.0.0:27017->27017/tcp
```

### 访问地址
- **前端**: http://localhost:3000
- **后端 API**: http://localhost:8080
- **AI 服务**: http://localhost:8000

---

## 📋 测试步骤

### 测试 1: 黑棋预览颜色

#### 步骤
1. 打开浏览器访问 http://localhost:3000
2. 登录账号（或注册新账号）
3. 创建一个玩家对战游戏
4. 等待另一个玩家加入（或用另一个浏览器/无痕模式登录另一个账号）
5. 游戏开始，黑棋先手
6. 将鼠标移动到棋盘上（不点击）

#### 预期结果
```
✅ 鼠标悬停时显示黑色半透明圆圈
✅ 预览颜色: rgba(0, 0, 0, 0.3)
✅ 预览位置准确
```

#### 实际效果
- [ ] 预览显示黑色 ✅
- [ ] 预览半透明 ✅
- [ ] 预览位置正确 ✅

---

### 测试 2: 白棋预览颜色

#### 步骤
1. 继续上面的游戏
2. 黑棋落子（点击棋盘）
3. 轮到白棋
4. 将鼠标移动到棋盘上（不点击）

#### 预期结果
```
✅ 鼠标悬停时显示白色半透明圆圈
✅ 预览颜色: rgba(255, 255, 255, 0.5)
✅ 预览有黑色边框
✅ 预览位置准确
```

#### 实际效果
- [ ] 预览显示白色 ✅
- [ ] 预览半透明 ✅
- [ ] 预览有边框 ✅
- [ ] 预览位置正确 ✅

---

### 测试 3: 实时刷新（玩家 A 视角）

#### 准备
1. 玩家 A 和玩家 B 同时在线
2. 玩家 A 是黑棋，玩家 B 是白棋
3. 玩家 A 已经落子，轮到玩家 B

#### 步骤
1. 玩家 A 等待（不刷新页面）
2. 玩家 B 落子
3. 观察玩家 A 的屏幕

#### 预期结果
```
✅ 玩家 B 落子后
✅ 2 秒内玩家 A 看到白子出现
✅ 不需要手动刷新页面
✅ 游戏状态自动更新
```

#### 实际效果
- [ ] 2 秒内看到更新 ✅
- [ ] 白子位置正确 ✅
- [ ] 游戏状态更新 ✅
- [ ] 没有闪烁 ✅

---

### 测试 4: 实时刷新（玩家 B 视角）

#### 准备
1. 玩家 A 和玩家 B 同时在线
2. 玩家 A 是黑棋，玩家 B 是白棋
3. 玩家 B 已经落子，轮到玩家 A

#### 步骤
1. 玩家 B 等待（不刷新页面）
2. 玩家 A 落子
3. 观察玩家 B 的屏幕

#### 预期结果
```
✅ 玩家 A 落子后
✅ 2 秒内玩家 B 看到黑子出现
✅ 不需要手动刷新页面
✅ 游戏状态自动更新
```

#### 实际效果
- [ ] 2 秒内看到更新 ✅
- [ ] 黑子位置正确 ✅
- [ ] 游戏状态更新 ✅
- [ ] 没有闪烁 ✅

---

### 测试 5: 连续落子测试

#### 步骤
1. 玩家 A 和玩家 B 快速交替落子
2. 每次落子后观察对方屏幕

#### 预期结果
```
玩家 A 落子 → 2秒 → 玩家 B 看到
玩家 B 落子 → 2秒 → 玩家 A 看到
玩家 A 落子 → 2秒 → 玩家 B 看到
...
```

#### 实际效果
- [ ] 每次都能在 2 秒内看到 ✅
- [ ] 没有丢失落子 ✅
- [ ] 顺序正确 ✅
- [ ] 游戏流畅 ✅

---

### 测试 6: AI 游戏预览颜色

#### 步骤
1. 创建一个人机对战游戏
2. 玩家是黑棋先手
3. 将鼠标移动到棋盘上

#### 预期结果
```
✅ 玩家回合（黑棋）→ 显示黑色预览
✅ AI 回合（白棋）→ 不显示预览（disabled）
```

#### 实际效果
- [ ] 玩家回合预览正确 ✅
- [ ] AI 回合禁用操作 ✅

---

## 🐛 常见问题排查

### 问题 1: 预览颜色不对

**症状**: 白棋回合显示黑色预览

**检查**:
```bash
# 检查 Board.vue 是否正确接收 nextPlayer prop
grep -A 5 "nextPlayer" weiqi-frontend/src/components/Board.vue

# 检查 Game.vue 是否传递了 nextPlayer
grep -A 3 ":next-player" weiqi-frontend/src/views/Game.vue
```

**解决**: 确保 `next-player` prop 正确传递

---

### 问题 2: 没有实时刷新

**症状**: 对方落子后需要手动刷新才能看到

**检查**:
```bash
# 检查自动刷新间隔
grep "startAutoRefresh" weiqi-frontend/src/views/Game.vue -A 10

# 应该看到: 2000 (2秒)
```

**解决**: 确保刷新间隔是 2000 毫秒

---

### 问题 3: 刷新太频繁导致闪烁

**症状**: 屏幕一直闪烁

**检查**:
```typescript
// 确保只在对方回合刷新
if (!gameStore.currentGame?.game_over && !isMyTurn.value) {
    refreshGame()
}
```

**解决**: 确保刷新条件正确

---

### 问题 4: 服务未启动

**症状**: 无法访问前端或后端

**检查**:
```bash
docker ps
```

**解决**:
```bash
cd /home/zhuji/weiqi-go
docker compose up -d --build
```

---

## 📊 性能测试

### 网络流量测试

#### 测试方法
1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签
3. 开始一局玩家对战
4. 观察网络请求

#### 预期结果
```
每 2 秒一次 GET 请求到 /v1/games/{id}
请求大小: ~1-2KB
响应时间: < 100ms
```

#### 评估标准
- ✅ 请求频率: 每 2 秒
- ✅ 请求大小: 合理
- ✅ 响应时间: 快速
- ✅ 没有错误请求

---

### CPU 使用率测试

#### 测试方法
```bash
# 监控 Docker 容器 CPU 使用率
docker stats --no-stream
```

#### 预期结果
```
weiqi-backend    CPU: < 5%
weiqi-ai         CPU: < 5%
weiqi-mongo      CPU: < 5%
```

#### 评估标准
- ✅ CPU 使用率低
- ✅ 内存使用稳定
- ✅ 没有内存泄漏

---

## ✅ 测试检查清单

### 预览颜色
- [ ] 黑棋预览显示黑色
- [ ] 白棋预览显示白色
- [ ] 白色预览有边框
- [ ] 预览位置准确
- [ ] 预览半透明效果正确

### 实时刷新
- [ ] 对方落子后 2 秒内看到
- [ ] 不需要手动刷新
- [ ] 没有闪烁
- [ ] 游戏状态正确更新
- [ ] 连续落子流畅

### 性能
- [ ] 网络请求频率合理（每 2 秒）
- [ ] CPU 使用率低
- [ ] 内存使用稳定
- [ ] 响应时间快

### 用户体验
- [ ] 游戏流畅
- [ ] 操作响应快
- [ ] 界面清晰
- [ ] 没有卡顿

---

## 🎯 测试结论

### 成功标准
- ✅ 所有预览颜色测试通过
- ✅ 所有实时刷新测试通过
- ✅ 性能测试达标
- ✅ 用户体验良好

### 如果测试失败
1. 检查服务是否正常运行
2. 查看浏览器控制台错误
3. 检查 Docker 日志
4. 参考常见问题排查

---

## 📝 测试报告模板

```markdown
## 测试报告

**测试时间**: YYYY-MM-DD HH:MM
**测试人员**: [姓名]
**测试环境**: [浏览器版本]

### 测试结果

#### 预览颜色
- 黑棋预览: [✅/❌]
- 白棋预览: [✅/❌]
- 预览边框: [✅/❌]

#### 实时刷新
- 刷新速度: [✅/❌]
- 刷新准确性: [✅/❌]
- 无闪烁: [✅/❌]

#### 性能
- 网络流量: [✅/❌]
- CPU 使用率: [✅/❌]
- 响应时间: [✅/❌]

### 发现的问题
[列出发现的问题]

### 建议
[提出改进建议]
```

---

## 🚀 快速测试命令

### 启动服务
```bash
cd /home/zhuji/weiqi-go
docker compose up -d --build
```

### 查看日志
```bash
# 查看后端日志
docker logs weiqi-backend -f

# 查看 AI 日志
docker logs weiqi-ai -f
```

### 检查服务状态
```bash
docker ps
```

### 停止服务
```bash
docker compose down
```

---

## 🎉 测试完成

完成所有测试后，确认：
- ✅ 预览颜色正确
- ✅ 实时刷新工作
- ✅ 性能良好
- ✅ 用户体验佳

**祝测试顺利！** 🎮✨

