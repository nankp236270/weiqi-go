# ğŸ¨ æ£‹ç›˜æ˜¾ç¤ºä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¶é—´**: 2025å¹´12æœˆ4æ—¥  
**é—®é¢˜**: å¼€å±€æ£‹ç›˜å…¨æ˜¯ç™½æ£‹

---

## ğŸ› é—®é¢˜æè¿°

### ç”¨æˆ·åé¦ˆ
**ç°è±¡**: AI å¯¹æˆ˜æ—¶ï¼Œå¼€å±€æ£‹ç›˜å…¨æ˜¯ç™½æ£‹

**å®é™…æƒ…å†µ**: 
- æ£‹ç›˜ä¸Šæ‰€æœ‰ä½ç½®éƒ½æ˜¾ç¤ºä¸ºç™½è‰²æ£‹å­
- åº”è¯¥æ˜¯ç©ºæ£‹ç›˜ï¼ˆæ²¡æœ‰æ£‹å­ï¼‰

---

## ğŸ” æ ¹æœ¬åŸå› 

### é—®é¢˜é“¾æ¡

#### 1. Player ç±»å‹çš„ JSON åºåˆ—åŒ–
åœ¨ä¿®å¤ Bug 26 æ—¶ï¼Œæˆ‘ä»¬æ·»åŠ äº† `Player` ç±»å‹çš„è‡ªå®šä¹‰ JSON åºåˆ—åŒ–ï¼š

```go
func (p Player) MarshalJSON() ([]byte, error) {
    switch p {
    case Black: return []byte(`"Black"`), nil
    case White: return []byte(`"White"`), nil
    default: return []byte(`"Empty"`), nil  // â† é—®é¢˜åœ¨è¿™é‡Œ
    }
}
```

#### 2. Board.Grid ä¹Ÿè¢«åºåˆ—åŒ–
`Board.Grid` æ˜¯ `[19][19]Player` ç±»å‹ï¼Œæ‰€ä»¥æ¯ä¸ªå…ƒç´ ä¹Ÿä¼šè¢«åºåˆ—åŒ–ï¼š

```go
type Board struct {
    Grid [BoardSize][BoardSize]Player `json:"grid"`
}
```

#### 3. åç«¯è¿”å›çš„æ•°æ®
```json
{
    "board": {
        "grid": [
            ["Empty", "Empty", "Empty", ...],  // â† å­—ç¬¦ä¸²ï¼
            ["Empty", "Empty", "Empty", ...],
            ...
        ]
    }
}
```

#### 4. å‰ç«¯åˆ¤æ–­é€»è¾‘
```typescript
// Board.vue
const stone = grid[y][x]
if (stone === 0) continue  // â† "Empty" !== 0

if (stone === 1) {
    // é»‘å­
    ctx.fillStyle = '#000000'
} else {
    // ç™½å­ â† æ‰€æœ‰ "Empty" éƒ½è¿›å…¥è¿™é‡Œï¼
    ctx.fillStyle = '#FFFFFF'
}
```

**ç»“æœ**: 
- `"Empty"` ä¸ç­‰äº `0`ï¼Œæ‰€ä»¥ä¸ä¼š `continue`
- `"Empty"` ä¸ç­‰äº `1`ï¼Œæ‰€ä»¥è¿›å…¥ `else` åˆ†æ”¯
- æ‰€æœ‰ç©ºä½éƒ½è¢«ç»˜åˆ¶æˆç™½å­ï¼

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆé€‰æ‹©

#### æ–¹æ¡ˆ 1: ä¿®æ”¹å‰ç«¯é€‚é…å­—ç¬¦ä¸² âŒ
```typescript
if (stone === "Empty") continue
if (stone === "Black") {
    ctx.fillStyle = '#000000'
} else if (stone === "White") {
    ctx.fillStyle = '#FFFFFF'
}
```

**ç¼ºç‚¹**:
- å­—ç¬¦ä¸²æ¯”è¾ƒæ€§èƒ½è¾ƒå·®
- JSON æ•°æ®é‡æ›´å¤§
- ä¸ç¬¦åˆæ£‹ç›˜æ•°æ®çš„è¯­ä¹‰ï¼ˆåº”è¯¥æ˜¯æ•°å­—çŸ©é˜µï¼‰

#### æ–¹æ¡ˆ 2: ä¿®æ”¹åç«¯ï¼ŒGrid ä¿æŒæ•°å­— âœ…
```go
// Board è‡ªå®šä¹‰åºåˆ—åŒ–ï¼ŒGrid è½¬ä¸ºæ•°å­—æ•°ç»„
func (b *Board) MarshalJSON() ([]byte, error) {
    grid := make([][]int8, BoardSize)
    for i := 0; i < BoardSize; i++ {
        grid[i] = make([]int8, BoardSize)
        for j := 0; j < BoardSize; j++ {
            grid[i][j] = int8(b.Grid[i][j])  // è½¬ä¸ºæ•°å­—
        }
    }
    // ...
}
```

**ä¼˜ç‚¹**:
- æ•°å­—æ¯”è¾ƒæ€§èƒ½å¥½
- JSON æ•°æ®é‡å°
- ç¬¦åˆæ£‹ç›˜æ•°æ®çš„è¯­ä¹‰
- åªæœ‰ `next_player` éœ€è¦æ˜¯å­—ç¬¦ä¸²

---

## ğŸ”§ å…·ä½“å®ç°

### ä¿®æ”¹ game/board.go

#### 1. æ·»åŠ  json å¯¼å…¥
```go
import (
    "encoding/json"  // â† æ–°å¢
    "errors"
    "fmt"
    "strings"
)
```

#### 2. ä¿®æ”¹ Board ç»“æ„
```go
type Board struct {
    Grid [BoardSize][BoardSize]Player `json:"-"`  // â† ç¦ç”¨é»˜è®¤åºåˆ—åŒ–
}
```

#### 3. æ·»åŠ è‡ªå®šä¹‰åºåˆ—åŒ–
```go
// MarshalJSON è‡ªå®šä¹‰ Board çš„ JSON åºåˆ—åŒ–ï¼Œå°† Grid è½¬æ¢ä¸ºæ•°å­—æ•°ç»„
func (b *Board) MarshalJSON() ([]byte, error) {
    // åˆ›å»ºæ•°å­—æ•°ç»„
    grid := make([][]int8, BoardSize)
    for i := 0; i < BoardSize; i++ {
        grid[i] = make([]int8, BoardSize)
        for j := 0; j < BoardSize; j++ {
            grid[i][j] = int8(b.Grid[i][j])  // Player â†’ int8
        }
    }
    
    // åºåˆ—åŒ–ä¸º JSON
    type Alias struct {
        Grid [][]int8 `json:"grid"`
    }
    return json.Marshal(&Alias{
        Grid: grid,
    })
}
```

#### 4. æ·»åŠ è‡ªå®šä¹‰ååºåˆ—åŒ–
```go
// UnmarshalJSON è‡ªå®šä¹‰ Board çš„ JSON ååºåˆ—åŒ–
func (b *Board) UnmarshalJSON(data []byte) error {
    type Alias struct {
        Grid [][]int8 `json:"grid"`
    }
    var alias Alias
    if err := json.Unmarshal(data, &alias); err != nil {
        return err
    }
    
    // è½¬æ¢å› Player ç±»å‹
    for i := 0; i < BoardSize && i < len(alias.Grid); i++ {
        for j := 0; j < BoardSize && j < len(alias.Grid[i]); j++ {
            b.Grid[i][j] = Player(alias.Grid[i][j])  // int8 â†’ Player
        }
    }
    
    return nil
}
```

---

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰ âŒ

#### API å“åº”
```json
{
    "board": {
        "grid": [
            ["Empty", "Empty", "Black", "White", ...],
            ["Empty", "Empty", "Empty", "Empty", ...],
            ...
        ]
    },
    "next_player": "Black"
}
```

#### å‰ç«¯åˆ¤æ–­
```typescript
stone = "Empty"
stone === 0  // false
stone === 1  // false
// è¿›å…¥ elseï¼Œç»˜åˆ¶ç™½å­ âŒ
```

#### æ£‹ç›˜æ˜¾ç¤º
```
âšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšª
âšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšª
âšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšªâšª
...
å…¨æ˜¯ç™½å­ï¼âŒ
```

---

### ä¿®å¤å âœ…

#### API å“åº”
```json
{
    "board": {
        "grid": [
            [0, 0, 1, 2, 0, ...],
            [0, 0, 0, 0, 0, ...],
            ...
        ]
    },
    "next_player": "Black"
}
```

#### å‰ç«¯åˆ¤æ–­
```typescript
stone = 0
stone === 0  // true
// continueï¼Œä¸ç»˜åˆ¶ âœ…

stone = 1
stone === 1  // true
// ç»˜åˆ¶é»‘å­ âœ…

stone = 2
stone === 1  // false
// è¿›å…¥ elseï¼Œç»˜åˆ¶ç™½å­ âœ…
```

#### æ£‹ç›˜æ˜¾ç¤º
```
â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œ
â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œ
â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œ
...
ç©ºæ£‹ç›˜ï¼âœ…

è½å­åï¼š
â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œ
â¬œâ¬œâ¬œâš«â¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œ
â¬œâ¬œâ¬œâ¬œâšªâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œâ¬œ
...
æ­£ç¡®æ˜¾ç¤ºï¼âœ…
```

---

## ğŸ¯ æ•°æ®ç±»å‹æ€»ç»“

### æœ€ç»ˆçš„æ•°æ®ç±»å‹è®¾è®¡

| å­—æ®µ | åç«¯ç±»å‹ | JSON ç±»å‹ | å‰ç«¯ç±»å‹ | è¯´æ˜ |
|------|---------|----------|---------|------|
| `next_player` | `Player` (int8) | `"Black"` / `"White"` | `'Black' \| 'White'` | å­—ç¬¦ä¸²ï¼Œä¾¿äºåˆ¤æ–­ |
| `board.grid[i][j]` | `Player` (int8) | `0` / `1` / `2` | `number` | æ•°å­—ï¼Œæ€§èƒ½å¥½ |

### ä¸ºä»€ä¹ˆä¸åŒï¼Ÿ

#### next_player ä½¿ç”¨å­—ç¬¦ä¸²
```typescript
// å‰ç«¯åˆ¤æ–­æ›´ç›´è§‚
if (game.next_player === 'Black') {
    // é»‘æ£‹å›åˆ
}
```

#### grid ä½¿ç”¨æ•°å­—
```typescript
// æ€§èƒ½æ›´å¥½ï¼Œæ•°æ®æ›´ç´§å‡‘
if (stone === 0) continue      // ç©ºä½
if (stone === 1) drawBlack()   // é»‘å­
if (stone === 2) drawWhite()   // ç™½å­
```

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### åç«¯æ–‡ä»¶

#### game/board.go
1. æ·»åŠ  `encoding/json` å¯¼å…¥
2. ä¿®æ”¹ `Board` ç»“æ„ï¼Œç¦ç”¨ `Grid` çš„é»˜è®¤åºåˆ—åŒ–
3. æ·»åŠ  `Board.MarshalJSON()` æ–¹æ³•
4. æ·»åŠ  `Board.UnmarshalJSON()` æ–¹æ³•

---

## âœ… æµ‹è¯•éªŒè¯

### ç©ºæ£‹ç›˜æµ‹è¯•
1. âœ… åˆ›å»ºæ–°æ¸¸æˆ
2. âœ… æ£‹ç›˜æ˜¾ç¤ºä¸ºç©ºï¼ˆæ²¡æœ‰æ£‹å­ï¼‰
3. âœ… ä¸å†æ˜¾ç¤ºå…¨ç™½æ£‹

### è½å­æµ‹è¯•
1. âœ… ç©å®¶ï¼ˆé»‘æ£‹ï¼‰è½å­
2. âœ… é»‘å­æ­£ç¡®æ˜¾ç¤º
3. âœ… AIï¼ˆç™½æ£‹ï¼‰è½å­
4. âœ… ç™½å­æ­£ç¡®æ˜¾ç¤º
5. âœ… ç©ºä½ä»ç„¶ä¸ºç©º

### æ•°æ®éªŒè¯
```bash
# éªŒè¯ grid è¿”å›æ•°å­—
curl http://localhost:8080/v1/games/{id} | jq '.board.grid[0][0]'
# è¾“å‡º: 0 âœ…

# éªŒè¯ next_player è¿”å›å­—ç¬¦ä¸²
curl http://localhost:8080/v1/games/{id} | jq '.next_player'
# è¾“å‡º: "Black" âœ…
```

---

## ğŸ’¡ æŠ€æœ¯æ€»ç»“

### å…³é”®ç‚¹
1. **è‡ªå®šä¹‰åºåˆ—åŒ–** - å¯ä»¥æ§åˆ¶ä¸åŒå­—æ®µçš„åºåˆ—åŒ–æ–¹å¼
2. **ç±»å‹è½¬æ¢** - `Player` â†’ `int8` â†’ JSON æ•°å­—
3. **æ€§èƒ½ä¼˜åŒ–** - æ•°å­—æ•°ç»„æ¯”å­—ç¬¦ä¸²æ•°ç»„æ›´é«˜æ•ˆ
4. **è¯­ä¹‰æ­£ç¡®** - æ£‹ç›˜åº”è¯¥æ˜¯æ•°å­—çŸ©é˜µ

### ç»éªŒæ•™è®­
1. âœ… æ·»åŠ è‡ªå®šä¹‰åºåˆ—åŒ–æ—¶è¦è€ƒè™‘æ‰€æœ‰ä½¿ç”¨è¯¥ç±»å‹çš„åœ°æ–¹
2. âœ… ä¸æ˜¯æ‰€æœ‰å­—æ®µéƒ½éœ€è¦ç›¸åŒçš„åºåˆ—åŒ–æ–¹å¼
3. âœ… æ£‹ç›˜æ•°æ®åº”è¯¥ä¿æŒä¸ºæ•°å­—ï¼ˆæ€§èƒ½å’Œè¯­ä¹‰ï¼‰
4. âœ… åªæœ‰éœ€è¦äººç±»å¯è¯»çš„å­—æ®µæ‰ç”¨å­—ç¬¦ä¸²

---

## ğŸ‰ ä¿®å¤æ€»ç»“

### è§£å†³çš„é—®é¢˜
- âœ… **å¼€å±€æ£‹ç›˜å…¨æ˜¯ç™½æ£‹** â†’ ç°åœ¨æ­£ç¡®æ˜¾ç¤ºç©ºæ£‹ç›˜
- âœ… **æ£‹å­æ˜¾ç¤ºé”™è¯¯** â†’ ç°åœ¨æ­£ç¡®æ˜¾ç¤ºé»‘ç™½æ£‹å­
- âœ… **æ•°æ®ç±»å‹ä¸ä¸€è‡´** â†’ ç°åœ¨ç±»å‹æ­£ç¡®ä¸”é«˜æ•ˆ

### æŠ€æœ¯æ”¹è¿›
- âœ… **Board è‡ªå®šä¹‰åºåˆ—åŒ–** - Grid ä¿æŒæ•°å­—
- âœ… **Player è‡ªå®šä¹‰åºåˆ—åŒ–** - next_player ä½¿ç”¨å­—ç¬¦ä¸²
- âœ… **æ€§èƒ½ä¼˜åŒ–** - æ•°å­—æ•°ç»„æ›´é«˜æ•ˆ
- âœ… **ç±»å‹æ­£ç¡®** - ç¬¦åˆæ•°æ®è¯­ä¹‰

---

**ğŸ® æ£‹ç›˜æ˜¾ç¤ºé—®é¢˜å·²å®Œå…¨ä¿®å¤ï¼** âœ¨

ç°åœ¨å¯ä»¥ï¼š
- âœ… æ­£ç¡®æ˜¾ç¤ºç©ºæ£‹ç›˜
- âœ… æ­£ç¡®æ˜¾ç¤ºé»‘ç™½æ£‹å­
- âœ… æ€§èƒ½æ›´å¥½ï¼ˆæ•°å­—æ¯”è¾ƒï¼‰
- âœ… æ•°æ®æ›´ç´§å‡‘ï¼ˆJSON æ›´å°ï¼‰

